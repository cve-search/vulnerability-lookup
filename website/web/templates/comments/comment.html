{% extends "main.html" %}
{% block head %}
{{ super() }}
<script src="{{ url_for('static', filename='js/pretty-print-json.min.js') }}"></script>
<script src="{{ url_for('static', filename='js/utils.js') }}"></script>
<link rel="stylesheet" href="{{ url_for('static', filename='css/pretty-print-json.css') }}" />
{% endblock %}
{% block title %}Comment - {{ comment.title }}{% endblock %}
{% block content %}
<div class="row">
  <div class="col">
    <h1><a href="{{ url_for('comment_bp.get', comment_uuid=comment.uuid) }}">{{ comment.title }}</a></h1>
  </div>
  <div class="col text-end">
    <div class="btn-group" role="group">
      <button id="btnGroupDropShare" type="button" class="btn btn-primary" data-bs-toggle="dropdown" aria-expanded="false">
        {{ render_icon('share') }}
      </button>
      <ul class="dropdown-menu" aria-labelledby="btnGroupDropShare">
        <li><a class="dropdown-item" href="https://news.ycombinator.com/submitlink?u=https://{{ config.PUBLIC_DOMAIN }}{{ url_for('comment_bp.get', comment_uuid=comment.uuid) }}&t={{ comment.title }}" target="_blank" title="Share on Hacker News">Hacker News</a></li>
        <li><a class="dropdown-item" href="https://www.linkedin.com/shareArticle?mini=true&url=https://{{ config.PUBLIC_DOMAIN }}{{ url_for('comment_bp.get', comment_uuid=comment.uuid) }}&title={{ comment.title }}" target="_blank" title="Share on LinkedIn">LinkedIn</a></li>
        <li><a class="dropdown-item" href="https://mastodonshare.com/?text={{ comment.title }}&url=https://{{ config.PUBLIC_DOMAIN }}{{ url_for('comment_bp.get', comment_uuid=comment.uuid) }}" target="_blank" title="Share on Mastodon">Mastodon</a></li>
        <li><a class="dropdown-item" href="https://www.newspipe.org/bookmark/bookmarklet?href=https://{{ config.PUBLIC_DOMAIN }}{{ url_for('comment_bp.get', comment_uuid=comment.uuid) }}&title={{ comment.title }}" target="_blank" title="Share on Newspipe">Newspipe</a></li>
        <li><a class="dropdown-item" href="https://api.pinboard.in/v1/posts/add?url=https://{{ config.PUBLIC_DOMAIN }}{{ url_for('comment_bp.get', comment_uuid=comment.uuid) }}&description=%27{{ comment.title }}%27" target="_blank" title="Share on Pinboard">Pinboard</a></li>
        <li><a class="dropdown-item" href="https://reddit.com/submit?url=https://{{ config.PUBLIC_DOMAIN }}{{ url_for('comment_bp.get', comment_uuid=comment.uuid) }}&title={{ comment.title }}" target="_blank" title="Share on Reddit">Reddit</a></li>
      </ul>
      <a type="button" class="btn btn-primary" onclick="copyCurrentPageURL()">{{ render_icon('clipboard') }}</a>
      {% if current_user.is_authenticated %}
      <a type="button" class="btn btn-primary" title="Edit" aria-label="Edit" href="{{ url_for('comment_bp.form', comment_uuid=comment.uuid) }}"> {{ render_icon('pen') }}</a>
      {% endif %}
    </div>
  </div>
</div>
{% if comment.meta %}
{% for elem in comment.meta %}
  {% if 'tags' in elem %}
    <h5>
    {% for tag in elem['tags'] %}
    <span class="badge bg-primary"><a class="link-light" href="{{ url_for('comments_bp.list_comments', meta='%5B%7B%22tags%22%3A%20%5B%22'+tag+'%22%5D%7D%5D') }}">{{ tag }}</a></span>
    {% endfor %}
    </h5>
  {% endif %}
{% endfor %}
{% endif %}
<p>Created on {{ comment.creation_timestamp | datetimeformat }} and updated on {{ comment.timestamp | datetimeformat }}.</p>
<h2>Description</h2>
<span id="markdown-description" class="markdown-description">{{ description | safe }}</span>
<br />
<h2>Associated vulnerability</h2>
<a href="{{ url_for('home_bp.vulnerability_view', vulnerability_id=comment.vulnerability) }}">{{ comment.vulnerability }}</a>
{% if comment.related_vulnerabilities %}
<br /><br />
<h2>Related vulnerabilities</h2>
<ul class="list-group">
{% for vuln in comment.related_vulnerabilities %}
    <li class="list-group-item"><a href="{{ url_for('home_bp.vulnerability_view', vulnerability_id=vuln) }}">{{ vuln }}</a></li>
{% endfor %}
</ul>
<br />
{% endif %}
{% if comment.meta %}
<h2>Meta</h2>
<pre id="jsoncontainer">{{ comment.meta | tojson(indent=2) }}</pre>
{% endif %}
<br />
<h2>Author</h2>
<a href="{{ url_for('user_bp.profile', login=comment.author.login) }}">{{ comment.author.name }}</a>
<br /><br />
<script>
  document.addEventListener("DOMContentLoaded", function() {
    jsonContainer = document.getElementById("jsoncontainer");
    if (jsonContainer) {
      jsonContainer.innerHTML = prettyPrintJson.toHtml(JSON.parse(jsonContainer.innerText));
    }

    // Post formatting
    document.getElementById("markdown-description").innerHTML = linkifySecurityIdentifiers(document.getElementById("markdown-description").innerHTML);
    formatMarkdownOutput();
  });

  function copyCurrentPageURL() {
      const currentURL = window.location.href; // Get the current page URL
      navigator.clipboard.writeText(currentURL).then(() => {
        alert("The comment permalink has been copied to your clipboard.");
      }).catch(err => {
        console.error('Failed to copy: ', err);
      });
    }
</script>
{% endblock %}
