#!/usr/bin/env python3

from __future__ import annotations

from subprocess import Popen, run

from vulnerabilitylookup.default import get_homedir

importers = [
    'nvd_importer',
    'cvelist_importer',
    'cisa_known_exploited',
    'gsd_importer',
    'pysec_importer',
    'github_importer',
    'variot_importer',
    'jvndb_importer',
    'tailscale_importer',
    'ossf_malicious_importer',
    'csaf_certbund_importer',
    'csaf_siemens_importer',
    'csaf_redhat_importer',
    'csaf_cisa_importer',
    'csaf_cisco_importer',
    'csaf_sick_importer',
    'csaf_ox_importer',
    'csaf_nozominetworks_importer'
]


def main() -> None:
    # Just fail if the env isn't set.
    get_homedir()
    print('Start backend (redis)...')
    p = run(['run_backend', '--start'])
    p.check_returncode()
    print('done.')
    for importer in importers:
        print(f'Start {importer}...')
        Popen([importer])
        print('done.')
    print('Start website...')
    Popen(['start_website'])
    print('done.')


if __name__ == '__main__':
    main()
